---
trigger:
  - main
pool:
  vmImage: windows-latest
steps:
  - task: UseDotNet@2
    inputs:
      packageType: sdk
      version: 8.x
      installationPath: $(Agent.ToolsDirectory)/dotnet
  - task: DotNetCoreCLI@2
    inputs:
      command: restore
      projects:
        - ind-tableau-alert-dashboard-risk-queue/ind-tableau-alert-dashboard-risk-queue.csproj
        - ind-tableau-alert-dashboard-risk-queue-unittest/ind-tableau-alert-dashboard-risk-queue-unittest.csproj
  - task: DotNetCoreCLI@2
    inputs:
      command: build
      projects:
        - ind-tableau-alert-dashboard-risk-queue/ind-tableau-alert-dashboard-risk-queue.csproj
        - ind-tableau-alert-dashboard-risk-queue-unittest/ind-tableau-alert-dashboard-risk-queue-unittest.csproj
  - task: DotNetCoreCLI@2
    inputs:
      command: test
      projects: "**/ind-tableau-alert-dashboard-risk-queue-unittest/ind-tableau-alert\
        -dashboard-risk-queue-unittest.csproj"
      arguments: --collect:"Code Coverage"
  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Coverlet
      summaryFileLocation: $(Build.SourcesDirectory)/TestResults/*.xml
      reportDirectory: $(Build.ArtifactStagingDirectory)/coverage-report
